
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="https://www.w3.org/1999/xhtml">

<head>


 <title>USACO</title>
 <link rel="stylesheet" type="text/css" href="current/usaco.css">
 <script src="current/js/jquery.min.js"></script>
 <script src="current/js/d3.v3.min.js"></script>

<META HTTP-EQUIV="EXPIRES" CONTENT="0">
 <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
 <META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    "HTML-CSS": {
	scale: 85,
	preferredFont: "STIX"
    },
  tex2jax: {
    inlineMath: [['$','$'],['\\(','\\)']],
    processEscapes: true,
    skipTags: ['pre'],
    processClass: "mathjax",
    ignoreClass: "no-mathjax"
  }
});
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</head>

<body class="no-mathjax">
 <div align="center">
  <div class="shadow1">

   <div class="content">

  
 <a href="index.php"><img src="current/images/usaco_logo.png" height="130px" border="0px" /></a> 

    <div class="navbar" align="left" border="10px">
     <ul>
      <li><a href="index.php">Overview</a></li> 
      <li><a href="index.php?page=training">Training</a></li>
      <li><a href="index.php?page=contests">Contests</a></li>
      <li><a href="index.php?page=history">History</a></li>
      <li><a href="index.php?page=staff">Staff</a></li>
      <li><a href="index.php?page=resources">Resources</a></li>
     </ul>
    </div><br/>

   
    


<div style="position:relative; float:left; left:10px; top:-50px; width:550px;"> 
<div class="panel">

<h2> USACO 2021 US Open, Platinum </h2>
<h2> Problem 2. Routing Schemes </h2>
 
</div>
</div>

<div align="right" style="position:relative; float:right; right:30px; top:-40px; width:350px;">

<button style="margin-bottom:6px;" type="button" onClick="window.location='index.php?page=open21results';">Return to Problem List</button><br style="padding-top:6px"/>
Contest has ended.

</div>

<br style="clear:both" />


<div id="last-status" style="padding:10px; position:relative; float:left; left:30px; top:-45px; width:820px; border:1px solid black; background-color:#FFF; " 
	data-response-code="-1" data-sid="-1"> 
   <img src="current/images/ajax.gif"/> <p style="display:inline;"> <b>Log in to allow submissions in analysis mode</b></p>
<div id="trial-information"></div>
<p style="text-align:left;" class="mono prewrap output-data"></p>
</div>

<br style="clear:both" />

<div align="right" style="position:relative; float:right; right:40px; top:-93px; width:350px; z-index:2; padding:0px;">

<form style="padding-top:60px;" action=""> 
<select name="lang" style="background-color:#eee;" id="choose-language">
<option value='en' selected='yes'>English (en)</option>
<option value='fr'>French (fr)</option>
<option value='ru'>Russian (ru)</option>
<option value='es'>Spanish (es)</option>
<option value='zh'>Chinese (zh)</option>
</select>
</form>

</div>

<div align="left" style="position:relative; float:left; left:30px; top:-100px; width:840px; z-index:1;"> 
<div align="left" class="problem-text" style='width:800px; padding-top:10px;'>
<span id="probtext-text" class="mathjax">Consider a network of $N$ ($2\le N\le 100$) nodes labeled $1\ldots N$. Each node
is designated as a sender, a receiver, or neither. The number of senders, $S$,
is equal to the number of receivers ($S\ge 1$). 

<p>The connections between the nodes in this network can be described by a list of
directed edges each of the form $i\to j$, meaning that node $i$ may route to
node $j$. Interestingly, all of these edges satisfy the property that $i&lt;j$,
aside from $K$ that satisfy $i&gt;j$ ($0\le K\le 2$). There are no self-loops
(edges of the form $i\to i$).

<p>The description of a "routing scheme" consists of a set of $S$ directed paths
from senders to receivers such that no two of these paths share an endpoint.
That is, the paths connect distinct senders to distinct receivers. A path from a
sender $s$ to a receiver $r$ can be described as a sequence of nodes
<div class='math'>$$s=v_0\to v_1 \to v_2\to \cdots \to v_e=r$$</div>
such that the directed edges $v_i\to v_{i+1}$ exist for all $0\le i&lt;e$. A node
may appear more than once within the same path.

<p>Count the number of distinct routing schemes such that every directed edge is
traversed exactly once. Since the answer may be very large, report it modulo
$10^9+7$. It is guaranteed that there is at least
one routing scheme satisfying these constraints.

<p>Each input contains $T$ ($1\le T\le 20$) test cases that should be solved
independently. It is guaranteed that the sum of $N^2$ over all test cases does
not exceed $2\cdot 10^4$.

<p><div class='prob-in-spec'><h4>INPUT FORMAT (input arrives from the terminal / stdin):</h4>
The first line of the input contains $T$, the number of test cases.

<p>The first line of each test case contains the integers $N$ and $K$. Note that
$S$  is not explicitly given within the input.

<p>The second line of each test case contains a string of length $N$. The $i$-th
character of the string  is equal to S if the $i$-th node is a sender, R if the
$i$-th node is a receiver, or . if the $i$-th node is neither. The number of Rs
in this string is equal to the number of Ss, and there is at least one S.

<p>The next $N$ lines of each test case each contain a bit string of $N$ zeros and
ones. The $j$-th bit of the $i$-th line is equal to $1$ if there exists a
directed edge from node $i$  to node $j$, and $0$ otherwise. As there are no
self-loops, the main diagonal of the matrix consists solely of zeros.
Furthermore, there are exactly $K$ ones below the main diagonal. 

<p>Consecutive test cases are separated by newlines for readability.
</div>

<p><div class='prob-out-spec'><h4>OUTPUT FORMAT (print output to the terminal / stdout):</h4>
For each test case, the number of routing schemes such that every edge is
traversed exactly once, modulo $10^9+7$. It is guaranteed that there is at least
one valid routing scheme for each test case.
</div>

<p><h4>SAMPLE INPUT:</h4><pre class='in'>
2

8 0
SS....RR
00100000
00100000
00011000
00000100
00000100
00000011
00000000
00000000

13 0
SSS.RRRSS.RR.
0001000000000
0001000000000
0001000000000
0000111000000
0000000000000
0000000000000
0000000000000
0000000001000
0000000001000
0000000000110
0000000000000
0000000000000
0000000000000
</pre><h4>SAMPLE OUTPUT:</h4> <pre class='out'>
4
12
</pre>

<p>For the first test case, the edges are
$1\to 3, 2\to 3, 3\to 4, 3\to 5, 4\to 6, 5\to 6, 6\to 7, 6\to 8$.

<p>There are four possible routing schemes:

<p><ul><li>$1\to 3\to 4\to 6\to 7, 2\to 3\to 5\to 6\to 8$</li><li>$1\to 3\to 5\to 6\to 7, 2\to 3\to 4\to 6\to 8$</li><li>$1\to 3\to 4\to 6\to 8, 2\to 3\to 5\to 6\to 7$</li><li>$1\to 3\to 5\to 6\to 8, 2\to 3\to 4\to 6\to 7$</li></ul>

<p>For the second test case, the edges are
$1\to 4, 2\to 4, 3\to 4, 4\to 5,4\to 6,4\to 7, 8\to 10, 9\to 10, 10\to 11, 10\to 12$.

<p>One possible routing scheme consists of the following paths:

<p><ul><li>$1\to 4\to 5$</li><li>$2\to 4\to 7$</li><li>$3\to 4\to 6$</li><li>$8\to 10\to 12$</li><li>$9\to 10\to 11$</li></ul>

<p>In general, senders $\{1,2,3\}$ can route to some permutation of receivers
$\{5,6,7\}$ and senders $\{8,9\}$ can route to some permutation of receivers
$\{11,12\}$, giving an answer of $6\cdot 2=12$.

<p><h4>SAMPLE INPUT:</h4><pre class='in'>
2

5 1
SS.RR
00101
00100
10010
00000
00000

6 2
S....R
001000
000100
010001
000010
001000
000000
</pre><h4>SAMPLE OUTPUT:</h4> <pre class='out'>
3
1
</pre>

<p>For the first test case, the edges are $1\to 3, 1\to 5, 2\to 3, 3\to 1, 3\to 4$.

<p>There are three possible routing schemes:

<p><ul><li>$1\to 3\to 1\to 5$, $2\to 3\to 4$</li><li>$1\to 3\to 4$,
$2\to 3\to 1\to 5$</li><li>$1\to 5$, $2\to 3\to 1\to 3\to 4$</li></ul>

<p>For the second test case, the edges are
$1\to 3, 2\to 4, 3\to 2,3\to 6, 4\to 5, 5\to 3$.

<p>There is only one possible routing scheme:
$1\to 3\to 2\to 4\to 5\to 3\to 6$.

<p><h4>SAMPLE INPUT:</h4><pre class='in'>
5

3 2
RS.
010
101
100

4 2
.R.S
0100
0010
1000
0100

4 2
.SR.
0000
0011
0100
0010

5 2
.SSRR
01000
10101
01010
00000
00000

6 2
SS..RR
001010
000010
000010
000010
100101
000000
</pre><h4>SAMPLE OUTPUT:</h4> <pre class='out'>
2
1
2
6
24
</pre>

<p>Some additional small test cases.

<p><div class='prob-section'><h4>SCORING:</h4>

<p><ul><li>Test cases 4-5 satisfy $N\le 6$.</li><li>Test cases 6-7 satisfy $K=0$.</li><li>Test cases 8-12 satisfy $K=1$.</li><li>Test cases 13-24 satisfy $K=2$.</li></ul>

<p></div>

<p>
<p>Problem credits: Benjamin Qi
</span>
</div>

           Contest has ended.  No further submissions allowed.
    
</div>

<div align="left" style="position:relative; float:left; left:30px; top:-70px; width:840px;"> 

</div>

<br style="clear:both" />

<script>
 var retries = 100, timeout = 1000;

 function postback()
 { 
     var sid = $('#last-status').data('sid'); if (sid == -1) return;
     $.post('current/tpcm/status-update.php', { sid: sid }, update_response, 'json'); 
 }

 function update_response(s)
 {
     // only try a limited number of times
     if (--retries < 0) return;

     // if there is xml data, update the DOM
     if (s != null)
     {
	 $('#last-status img').attr("src","current/images/medal_none.png");
	 if (parseInt(s.cd) <= -8 && s.sc == 'status-working') { $('#last-status img').attr("src","current/images/ajax.gif"); }

         // change class and text of the response box
         $('#last-status').removeClass().addClass(s.sc);
         $('#last-status p').text(s.sr);

         // change the response code of the data section
         $('#last-status').data('response-code', parseInt(s.cd));
	 $('#last-status .output-data').hide();

	 if (s.output != null)
	 {
	     $('#last-status .output-data').show().text(s.output);
	     // if the status is in a "working" state, keep checking
	     if (parseInt($('#last-status').data('response-code')) <= -8)
		 { setTimeout(postback, timeout); timeout *= 1.1; }

	     return;
	 }

	 if (s.jd != null && s.jd.length != 0)
	     $('#trial-information').html(s.jd);
     }

     // if the status is in a "working" state, keep checking
     if (parseInt($('#last-status').data('response-code')) <= -8)
         { setTimeout(postback, timeout); timeout *= 1.1; }
 }

 $(document).ready(function(){
     $('#last-status .output-data').hide();
     $('#last-status img').attr("src","current/images/medal_none.png");
     if ($('#last-status').length) postback();

     $('.masterTooltip').hover(function(){
	 // Hover over code
	 var title = $(this).attr('title');
	 $(this).data('tipText', title).removeAttr('title');
	 $('<p class="tooltip"></p>').text(title).appendTo('body').fadeIn('fast');
     }, function() {
	 // Hover out code
	 $(this).attr('title', $(this).data('tipText'));
	 $('.tooltip').remove();
     }).mousemove(function(e) {
	 var mousex = e.pageX + 20; //Get X coordinates
	 var mousey = e.pageY + 10; //Get Y coordinates
	 $('.tooltip').css({ top: mousey, left: mousex })
     });
 });

 $('#choose-language').change(function(e){
     window.location = "index.php?page=viewproblem2&cpid=1141&lang=" + $(this).val();
 });

</script>


   </div>
  </div>
 </div>

 <br style="clear:both" />

<script>(function(){if (!document.body) return;var js = "window['__CF$cv$params']={r:'86a9ef0b6d130847',t:'MTcxMTQ4NTM5NS43NjgwMDA='};_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js',document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>

</html>


